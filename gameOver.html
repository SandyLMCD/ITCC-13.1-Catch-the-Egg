<!DOCTYPE html>
<html lang="en">
  <head>
    <link rel="icon" type="image/png" href="/assets/chicken_favicon.png" />
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="/styles/gameOverStyles.css" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Irish+Grover&family=Roboto:ital,wght@0,100..900;1,100..900&family=Special+Gothic+Expanded+One&display=swap"
      rel="stylesheet"
    />
    <title>GameOver</title>
  </head>
  <body>
    <div class="container">
      <div class="content-wrapper">
        <div class="game-over-box">
          <div class="game-over-text">
            <span class="main-text"
              >Game Over!<br />You ran out of lives<br
            /></span>
            <span class="score-text"
              >Your Score: <span id="score">0</span></span
            >
          </div>
          <div class="icon-row">
            <img
              class="icon"
              onClick="goToMainMenu()"
              src="/assets/home button-Photoroom.png"
            />
            <img
              class="icon"
              onClick="tryAgain()"
              src="/assets/replay button-Photoroom.png"
            />
          </div>
        </div>
        <div class="leaderboard-button" onClick="goToLeaderboard()">
          <div class="leaderboard-text">Leaderboard</div>
        </div>
      </div>
    </div>
    <script>
      document.addEventListener("DOMContentLoaded", () => {
        // Retrieve the score from localStorage
        const finalScore = localStorage.getItem("finalScore");

        // Display the score in the #score element
        const scoreElement = document.getElementById("score");
        if (finalScore) {
          scoreElement.textContent = finalScore;
        }
      });
    </script>
    <script src="/script.js"></script>
  </body>

  <script type="module">
    // Import the functions you need from the SDKs you need
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.8.0/firebase-app.js";
    import {
      getFirestore,
      collection,
      addDoc,
    } from "https://www.gstatic.com/firebasejs/11.8.0/firebase-firestore.js";

    // TODO: Add SDKs for Firebase products that you want to use
    // https://firebase.google.com/docs/web/setup#available-libraries

    // Your web app's Firebase configuration
    const firebaseConfig = {
      apiKey: "AIzaSyDI8wiXCt99E5T4S3CVDW7d8Mdg7Zpz5A8",
      authDomain: "catchtheeggleaderboard.firebaseapp.com",
      projectId: "catchtheeggleaderboard",
      storageBucket: "catchtheeggleaderboard.firebasestorage.app",
      messagingSenderId: "800278076059",
      appId: "1:800278076059:web:92c98bdae1f0fbe94a043e",
    };

    // Initialize Firebase
    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    document.addEventListener("DOMContentLoaded", () => {
      const finalScore = localStorage.getItem("finalScore");
      const playerName = localStorage.getItem("playerName");

      async function addScoreToLeaderboard() {
        if (finalScore && playerName) {
          try {
            await addDoc(collection(db, "leaderboard"), {
              name: playerName,
              score: parseInt(finalScore),
            });
          } catch (error) {
            console.error("Error adding document: ", error);
          }
        }
      }

      addScoreToLeaderboard();
    });
  </script>
</html>
